<!DOCTYPE html>
    <head>
        <title>Pool Shark</title>
        <link rel="icon" href="/static/favicon.ico" type="image/x-icon" />
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

        <script src="/static/jspsych-6.3.1/jspsych.js"></script>
        <script src="/static/jspsych-6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
        <script src="/static/jspsych-6.3.1/plugins/jspsych-image-keyboard-response.js"></script>
        <script src="/static/jspsych-6.3.1/plugins/jspsych-video-slider-response.js"></script>
        <script src="/static/jspsych-6.3.1/plugins/jspsych-preload.js"></script>
        <script src="/static/stimuli_order.js" id="stim_order" type="text/javascript"></script>
        <link href="/static/jspsych-6.3.1/fonts/">
        <link href="/static/jspsych-6.3.1/css/jspsych.css" rel="stylesheet" type="text/css">
    </head>
    <body>
    </body>

    <script>
        var timeline = [];

        var preload = {
            type: 'preload',
            auto_preload: true
        }

        var welcome = {
            type: 'html-keyboard-response',
            stimulus: "<p style='font-size: x-large;'>Welcome to the experiment. Press any key to begin.</p>"
        }

        var thanks = {
            type: 'html-keyboard-response',
            stimulus: "You have finished this experiment! Thank you for participating.<br>Press any key. ",
            on_finish: function (){
                var trial_dat = jsPsych.data.getLastTrialData().json()
                if (JSON.parse(trial_dat)['trial_type'] === 'video_slider_response'){
                     $.ajax({
                         type: "POST",
                         contentType: "application/json;charset=utf-8",
                         url:"/",
                         traditional: true,
                         data: JSON.stringify({"trial":trial_dat}),
                         dataType: "json"});
                }
            }
        }

        var instructions = {
            type: 'html-keyboard-response',
            stimulus: '<span style="font-size: x-large; color:black;">' +
                "<p>In this experiment, You'll make judgements about a series of billiard ball events, and possible " +
                "alternative events.</p><p> Make your judgement based on the videos displayed by using a slider bar to " +
                "indicate your agreement with the statements on the screen.</p></span>" +
                "<div class='row' style='display: inline-flex;'>" +
                "<div><img src='static/img/ballAimage.png' style='width:50%;'><p class='small'><strong>Ball A</strong></p></div>" +
                "<div><img src='static/img/exampletrial.png' style='width:-webkit-fill-available;border-style: double;'><p class='small'><strong>Example</strong></p></div>" +
                "<div><img src='static/img/ballBimage.png' style='width:50%;'><p class='small'><strong>Ball B</strong></p></div>" +
                "</div><div><br><br><p style='font-size: x-large;'>Press any key to begin.</p></div>" +'',
            post_trial_gap: 1000,
            on_finish: function(){$.ajax({
                         type: "POST",
                         contentType: "application/json;charset=utf-8",
                         url:"/",
                         traditional: true,
                         data: jsPsych.data.getLastTrialData().json(),
                         dataType: "json"});
                localStorage.setItem('sub_dat', jsPsych.data.getLastTrialData().json());

            }

        };

        var test_trial  = {
            type: 'video-slider-response',
            stimulus: jsPsych.timelineVariable('stimulus'),
            labels: ['Totally Disagree', 'Totally Agree'],
            min: 1,
            max: 100,
            step: 1,
            slider_start: 50,
            prompt: jsPsych.timelineVariable('prompts'),
            require_movement: true,
            autoplay: true,
            rate: 1.5,
            width: 780,
            response_ends_trial: true,
            controls: true,
            on_finish: function () {
                trial_dat = jsPsych.data.getLastTrialData().json()
                $.ajax({
                    type: "POST",
                    contentType: "application/json;charset=utf-8",
                    url: "/",
                    traditional: true,
                    data: trial_dat,
                    dataType: "json"
                });

            }
        }

        var test_stimuli = Stim_order

        var fixation = {
            type: 'html-keyboard-response',
            stimulus: '<div style="font-size:60px;"> + </div>',
            choices: jsPsych.NO_KEYS,
            trial_duration: function(){return jsPsych.randomization.sampleWithoutReplacement([250, 500, 750, 1000, 1250,
                1500, 1750, 2000], 1)[0]},
            data:{task:'fixation'}
            }


        var test_procedure = {
            timeline: [test_trial, fixation],
            timeline_variables: test_stimuli,
            randomize_order: true
        }

        //jsPsych.data.addProperties({subjectID: JSON.parse(localStorage['sub_dat'])[0]['subjectID']});
        jsPsych.data.addProperties({
            subjectID: jsPsych.randomization.randomID(15)
        });
        timeline.push(preload, welcome,instructions,  test_procedure, thanks)

        function saveData(){
            var subject_dat = jsPsych.data.get().filter({'trial_type':'video-slider-response'}).json()

            $.ajax({
                type: "POST",
                contentType: "application/json;charset=utf-8",
                url:"http://127.0.0.1:5000/",
                traditional: true,
                data: JSON.stringify(jsPsych.data.get().filter({'trial_type':'video-slider-response'}).json()),
                dataType: "json"
            });
        }

        jsPsych.init({
            timeline:timeline,
            show_progress_bar: true,
            on_finish: function(){
                jsPsych.data.displayData();
                },
            override_safe_mode: true
        })

    </script>


</DOCTYPEhtml>
